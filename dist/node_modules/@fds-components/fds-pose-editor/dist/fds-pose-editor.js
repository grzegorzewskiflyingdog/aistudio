var app=function(){"use strict";function e(){}function t(e){return e()}function o(){return Object.create(null)}function n(e){e.forEach(t)}function i(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t,o){e.insertBefore(t,o||null)}function s(e){e.parentNode&&e.parentNode.removeChild(e)}function l(e,t,o){null==o?e.removeAttribute(t):e.getAttribute(t)!==o&&e.setAttribute(t,o)}function d(e){const t={};for(const o of e)t[o.name]=o.value;return t}let c;function h(e){c=e}function u(){if(!c)throw new Error("Function called outside component initialization");return c}const m=[],f=[];let g=[];const p=[],b=Promise.resolve();let B=!1;function _(e){g.push(e)}const x=new Set;let C=0;function w(){if(0!==C)return;const e=c;do{try{for(;C<m.length;){const e=m[C];C++,h(e),L(e.$$)}}catch(e){throw m.length=0,C=0,e}for(h(null),m.length=0,C=0;f.length;)f.pop()();for(let e=0;e<g.length;e+=1){const t=g[e];x.has(t)||(x.add(t),t())}g.length=0}while(m.length);for(;p.length;)p.pop()();B=!1,x.clear(),h(e)}function L(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(_)}}const N=new Set;function A(e,t){const o=e.$$;null!==o.fragment&&(!function(e){const t=[],o=[];g.forEach((n=>-1===e.indexOf(n)?t.push(n):o.push(n))),o.forEach((e=>e())),g=t}(o.after_update),n(o.on_destroy),o.fragment&&o.fragment.d(t),o.on_destroy=o.fragment=null,o.ctx=[])}function y(e,t){-1===e.$$.dirty[0]&&(m.push(e),B||(B=!0,b.then(w)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function v(r,a,l,d,u,m,f,g=[-1]){const p=c;h(r);const b=r.$$={fragment:null,ctx:[],props:m,update:e,not_equal:u,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(p?p.$$.context:[])),callbacks:o(),dirty:g,skip_bound:!1,root:a.target||p.$$.root};f&&f(b.root);let B=!1;if(b.ctx=l?l(r,a.props||{},((e,t,...o)=>{const n=o.length?o[0]:t;return b.ctx&&u(b.ctx[e],b.ctx[e]=n)&&(!b.skip_bound&&b.bound[e]&&b.bound[e](n),B&&y(r,e)),t})):[],b.update(),B=!0,n(b.before_update),b.fragment=!!d&&d(b.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);b.fragment&&b.fragment.l(e),e.forEach(s)}else b.fragment&&b.fragment.c();a.intro&&((x=r.$$.fragment)&&x.i&&(N.delete(x),x.i(C))),function(e,o,r,a){const{fragment:s,after_update:l}=e.$$;s&&s.m(o,r),a||_((()=>{const o=e.$$.on_mount.map(t).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...o):n(o),e.$$.on_mount=[]})),l.forEach(_)}(r,a.target,a.anchor,a.customElement),w()}var x,C;h(p)}let $;"function"==typeof HTMLElement&&($=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(i);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,o){this[e]=o}disconnectedCallback(){n(this.$$.on_disconnect)}$destroy(){A(this,1),this.$destroy=e}$on(t,o){if(!i(o))return e;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(o),()=>{const e=n.indexOf(o);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});let O=document.currentScript&&document.currentScript.src||new URL("fds-pose-editor.js",document.baseURI).href;class S{static async getInfo(e,t){let o="",n="",i=!1;t&&(t=t.replace("@fds-components/",""),o=S.get_href()+e+"-"+t+".json",n=`@fds-components/${t}/dist/${e}-${t}.json`);let r=await fetch(o).then((e=>(e.ok||(i=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0));return i&&(r=await fetch(n).then((e=>(e.ok||(i=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0))),r}static get_href(){return new URL("./",O).href}static get_local(){return new URL("./",O).pathname}}let Y={head:{boneColor:"#00009b",jointColor:"#9e323a"},"Shoulder L":{boneColor:"#993300",jointColor:""},"Shoulder R":{boneColor:"#990000",jointColor:""},"UpperArm L":{boneColor:"#669900",jointColor:"#349c00"},"UpperArm R":{boneColor:"#996600",jointColor:"#916100"},"LowerArm L":{boneColor:"#339900",jointColor:"#008400"},"LowerArm R":{boneColor:"#999900",jointColor:"#9a9900"},"Spine L":{boneColor:"#009999",jointColor:""},"Spine R":{boneColor:"#009900",jointColor:""},"UpperLeg L":{boneColor:"#006699",jointColor:"#003194"},"UpperLeg R":{boneColor:"#009933",jointColor:"#00a767"},"LowerLeg L":{boneColor:"#003399",jointColor:"#0011b3"},"LowerLeg R":{boneColor:"#009966",jointColor:"#00a49d"},"Eye L":{boneColor:"#a200a3",jointColor:"#9f002e"},"Eye R":{boneColor:"#320099",jointColor:"#9f002e"},"Ear L":{boneColor:"#990066",jointColor:"#980098"},"Ear R":{boneColor:"#660099",jointColor:"#6a009f"},"Delete L":{boneColor:"",jointColor:"#980032"},"Delete R":{boneColor:"",jointColor:"#9c006a"},"Hand L":{boneColor:"",jointColor:"#009933"},"Hand R":{boneColor:"",jointColor:"#669900"},"Foot L":{boneColor:"",jointColor:"#330098"},"Foot R":{boneColor:"",jointColor:"#006598"}},j={"mixamorig:Neck":{boneColor:"#a200a3",jointColor:"#9f002e"},"mixamorig:Head":{boneColor:"#a200a3",jointColor:"#9f002e"},"mixamorig:LeftArm":{boneColor:"#669900",jointColor:"#349c00"},"mixamorig:LeftForeArm":{boneColor:"#339900",jointColor:"#008400"},"mixamorig:RightArm":{boneColor:"#996600",jointColor:"#916100"},"mixamorig:RightForeArm":{boneColor:"#999900",jointColor:"#9a9900"},"mixamorig:LeftUpLeg":{boneColor:"#006699",jointColor:"#003194"},"mixamorig:LeftLeg":{boneColor:"#003399",jointColor:"#0011b3"},"mixamorig:LeftFoot":{boneColor:"#a200a3",jointColor:"#34009b"},"mixamorig:LeftToeBase":{boneColor:"#a200a3",jointColor:"#9f002e"},"mixamorig:RightUpLeg":{boneColor:"#009933",jointColor:"#00a767"},"mixamorig:RightLeg":{boneColor:"#009966",jointColor:"#00a49d"},"mixamorig:RightFoot":{boneColor:"#a200a3",jointColor:"#00659b"},"mixamorig:RightToeBase":{boneColor:"#a200a3",jointColor:"#9f002e"},"mixamorig:RightHand":{jointColor:"#649600"},"mixamorig:LeftHand":{jointColor:"#009731"}};let k=function(e=100){return new Promise((t=>{setTimeout((()=>{t("")}),e)}))};function M(e="hide",t,o,n){t.bones.forEach((function(t){(t.name.includes("Neck")||t.name.includes("Head")||t.name.includes("Foot")||t.name.includes("Toe")||t.name.includes("Spine")||t.name.includes("Hips")||t.name.includes("LeftShoulder")||t.name.includes("Shoulder"))&&o.forEach((function(o){o.name.replace("bone_","")==t.name&&(o.visibility="hide"==e?1e-5:1)}))})),n.forEach((function(t){(t.name.includes("Head")||t.name.includes("Spine"))&&(t.visibility="hide"==e?1e-5:1)}))}function I(e,t,o){let n=e,i=n.bones.find((e=>{if("mixamorig:Neck"==e.name)return e}));n.bones.find((e=>{if("mixamorig:LeftShoulder"==e.name)return e}));let r,a,s,l,d=n.bones.find((e=>{if("mixamorig:LeftArm"==e.name)return e})),c=n.bones.find((e=>{if("mixamorig:RightShoulder"==e.name)return e})),h=n.bones.find((e=>{if("mixamorig:RightUpLeg"==e.name)return e})),u=n.bones.find((e=>{if("mixamorig:LeftUpLeg"==e.name)return e})),m=[d.getTransformNode().absolutePosition,i.getTransformNode().absolutePosition];return t.length?(r=t.find((e=>"leftMShoulder"==e.id)),r=BABYLON.MeshBuilder.CreateTube("leftMShoulder",{path:m,instance:r},o)):(r=BABYLON.MeshBuilder.CreateTube("leftMShoulder",{updatable:!0,color:BABYLON.Color3.Red(),path:m,radius:.02},o),r.material=new BABYLON.StandardMaterial("bone"),r.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),r.material.emissiveColor=BABYLON.Color3.FromHexString("#993300"),r.material.disableLighting=!0,t.push(r)),m=[c.children[0].getTransformNode().absolutePosition,i.getTransformNode().absolutePosition],t.length&&(a=t.find((e=>"rightMShoulder"==e.id))),a?a=BABYLON.MeshBuilder.CreateTube("rightMShoulder",{path:m,instance:a},o):(a=BABYLON.MeshBuilder.CreateTube("rightMShoulder",{updatable:!0,path:m,radius:.02},o),a.material=new BABYLON.StandardMaterial("bone"),a.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),a.material.emissiveColor=BABYLON.Color3.FromHexString("#990000"),a.material.disableLighting=!0,t.push(a)),m=[h.getTransformNode().absolutePosition,i.getTransformNode().absolutePosition],t.length&&(s=t.find((e=>"rightMUpLeg"==e.id))),s?s=BABYLON.MeshBuilder.CreateTube("rightMShoulder",{path:m,instance:s},o):(s=BABYLON.MeshBuilder.CreateTube("rightMUpLeg",{updatable:!0,path:m,radius:.02},o),s.material=new BABYLON.StandardMaterial("bone"),s.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),s.material.emissiveColor=BABYLON.Color3.FromHexString("#009900"),s.material.disableLighting=!0,t.push(s)),m=[u.getTransformNode().absolutePosition,i.getTransformNode().absolutePosition],t.length&&(l=t.find((e=>"leftMUpLeg"==e.id))),l?l=BABYLON.MeshBuilder.CreateTube("leftMUpLeg",{path:m,instance:l},o):(l=BABYLON.MeshBuilder.CreateTube("leftMUpLeg",{updatable:!0,path:m,radius:.02},o),l.material=new BABYLON.StandardMaterial("bone"),l.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),l.material.emissiveColor=BABYLON.Color3.FromHexString("#009999"),l.material.disableLighting=!0,t.push(l)),t}function z(e,t){e.forEach((function(e){e.visibility=1e-5})),t.forEach((function(e){e.visibility=1e-5}))}function T({scene:e,extrusions:t,spheres:o,specialheadskeleton:n,bone_joint_diameter:i}){let r=t[4];o[1].bone.getTransformNode().absolutePosition;let a=BABYLON.Skeleton.Parse(JSON.parse('{"name":"Skelett","id":"skeleton0","bones":[{"parentBoneIndex":-1,"index":-1,"name":"Skelett","id":"Skelett","matrix":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":1},"rest":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0.38344693183898926,"13":-0.8335919976234436,"14":0.15880873799324036,"15":1},"linkedTransformNodeId":"Skelett"},{"parentBoneIndex":0,"index":0,"name":"head","id":"head","matrix":{"0":0.9992939233779907,"1":-0.035882167518138885,"2":-0.011142185889184475,"3":0,"4":0.031503062695264816,"5":0.6385743618011475,"6":0.7689149975776672,"7":0,"8":-0.020475229248404503,"9":-0.7687231302261353,"10":0.6392539143562317,"11":0,"12":0.3846602439880371,"13":0.7116702198982239,"14":0.14148575067520142,"15":1},"rest":{"0":0.9992939233779907,"1":-0.035882167518138885,"2":-0.011142182163894176,"3":0,"4":0.031503066420555115,"5":0.6385743618011475,"6":0.7689149975776672,"7":0,"8":-0.020475223660469055,"9":-0.7687231302261353,"10":0.6392539143562317,"11":0,"12":0.0012132823467254639,"13":1.5452622175216675,"14":-0.017323002219200134,"15":1},"linkedTransformNodeId":"head"},{"parentBoneIndex":1,"index":1,"name":"Eye L","id":"Eye L","matrix":{"0":0.7457199096679688,"1":-0.49956682324409485,"2":0.4408341646194458,"3":0,"4":0.5884072184562683,"5":0.18343466520309448,"6":-0.7874825596809387,"7":0,"8":0.31253582239151,"9":0.8466315269470215,"10":0.4307396411895752,"11":0,"12":-1.1238085306786161e-7,"13":0.1698397696018219,"14":-9.233612985326545e-8,"15":1},"rest":{"0":0.7457199096679688,"1":-0.4995667338371277,"2":0.4408341944217682,"3":0,"4":0.5884073376655579,"5":0.18343457579612732,"6":-0.7874825596809387,"7":0,"8":0.3125358521938324,"9":0.8466314673423767,"10":0.43073952198028564,"11":0,"12":-2.3515895009040833e-8,"13":0.16983982920646667,"14":-1.8719583749771118e-7,"15":1},"linkedTransformNodeId":"Eye L"},{"parentBoneIndex":2,"index":2,"name":"Ear L","id":"Ear L","matrix":{"0":0.8822540640830994,"1":-0.46167486906051636,"2":-0.09210913628339767,"3":0,"4":0.20932646095752716,"5":0.559956431388855,"6":-0.8016427755355835,"7":0,"8":0.4216754138469696,"9":0.6879717111587524,"10":0.5906643867492676,"11":0,"12":6.695975685033773e-8,"13":0.06881210952997208,"14":1.0096449898355786e-7,"15":1},"rest":{"0":0.8822540640830994,"1":-0.4616748094558716,"2":-0.09210919588804245,"3":0,"4":0.20932647585868835,"5":0.5599564909934998,"6":-0.8016427755355835,"7":0,"8":0.4216753840446472,"9":0.6879715919494629,"10":0.5906645655632019,"11":0,"12":1.8440186977386475e-7,"13":0.06881209462881088,"14":4.470348358154297e-8,"15":1},"linkedTransformNodeId":"Ear L"},{"parentBoneIndex":3,"index":3,"name":"Delete L","id":"Delete L","matrix":{"0":0.9998714327812195,"1":-0.015923963859677315,"2":0.0018920100992545485,"3":0,"4":0.01592392288148403,"5":0.9720301628112793,"6":-0.23431509733200073,"7":0,"8":0.001892179367132485,"9":0.23431512713432312,"10":0.9721588492393494,"11":0,"12":-2.011829138837129e-7,"13":0.10093274712562561,"14":-5.843645212166848e-8,"15":1},"rest":{"0":0.9998714327812195,"1":-0.015923980623483658,"2":0.0018919407157227397,"3":0,"4":0.01592394895851612,"5":0.9720302224159241,"6":-0.23431514203548431,"7":0,"8":0.0018922063754871488,"9":0.2343151569366455,"10":0.9721588492393494,"11":0,"12":-1.6565900295972824e-7,"13":0.10093274712562561,"14":-7.450580596923828e-9,"15":1},"linkedTransformNodeId":"Delete L"},{"parentBoneIndex":1,"index":4,"name":"Eye R","id":"Eye R","matrix":{"0":0.6691386699676514,"1":0.47098278999328613,"2":-0.5748293399810791,"3":0,"4":-0.6824186444282532,"5":0.08319882303476334,"6":-0.726211428642273,"7":0,"8":-0.29420801997184753,"9":0.8782103061676025,"10":0.37707898020744324,"11":0,"12":-0.007651345804333687,"13":0.17344820499420166,"14":-0.00021137796284165233,"15":1},"rest":{"0":0.6691386699676514,"1":0.47098278999328613,"2":-0.5748292207717896,"3":0,"4":-0.6824186444282532,"5":0.08319876343011856,"6":-0.726211428642273,"7":0,"8":-0.29420799016952515,"9":0.8782103657722473,"10":0.37707892060279846,"11":0,"12":-0.007651323452591896,"13":0.17344821989536285,"14":-0.00021135341376066208,"15":1},"linkedTransformNodeId":"Eye R"},{"parentBoneIndex":5,"index":5,"name":"Ear R","id":"Ear R","matrix":{"0":0.90474933385849,"1":0.38175061345100403,"2":0.18893161416053772,"3":0,"4":-0.08088511228561401,"5":0.5894708037376404,"6":-0.8037300109863281,"7":0,"8":-0.4181939959526062,"9":0.7118924856185913,"10":0.5642012357711792,"11":0,"12":1.1522569565158847e-7,"13":0.07159008085727692,"14":-3.4368889956226667e-9,"15":1},"rest":{"0":0.90474933385849,"1":0.38175055384635925,"2":0.18893161416053772,"3":0,"4":-0.0808851420879364,"5":0.5894706845283508,"6":-0.8037299513816833,"7":0,"8":-0.4181940257549286,"9":0.7118924260139465,"10":0.5642011761665344,"11":0,"12":1.7043203115463257e-7,"13":0.07159020751714706,"14":-1.4901161193847656e-8,"15":1},"linkedTransformNodeId":"Ear R"},{"parentBoneIndex":6,"index":6,"name":"Delete R","id":"Delete R","matrix":{"0":0.9999619722366333,"1":0.008652040734887123,"2":-0.0011213944526389241,"3":0,"4":-0.008651976473629475,"5":0.9669150710105896,"6":-0.2549518346786499,"7":0,"8":-0.0011215329868718982,"9":0.2549518346786499,"10":0.9669530391693115,"11":0,"12":2.170680772906053e-7,"13":0.10093282163143158,"14":5.400091040996813e-8,"15":1},"rest":{"0":0.9999619126319885,"1":0.008652021177113056,"2":-0.0011214111000299454,"3":0,"4":-0.008652004413306713,"5":0.9669150114059448,"6":-0.2549518644809723,"7":0,"8":-0.0011215397389605641,"9":0.2549518644809723,"10":0.9669530987739563,"11":0,"12":1.7043203115463257e-7,"13":0.10093280673027039,"14":6.146728992462158e-8,"15":1},"linkedTransformNodeId":"Delete R"},{"parentBoneIndex":0,"index":7,"name":"neutral_bone","id":"neutral_bone","matrix":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":-1,"7":0,"8":0,"9":1,"10":0,"11":0,"12":0.38344693183898926,"13":-0.8335919976234436,"14":0.15880873799324036,"15":1},"rest":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":3.422854177870249e-8,"6":-0.9999999403953552,"7":0,"8":0,"9":0.9999999403953552,"10":3.422854177870249e-8,"11":0,"12":0,"13":0,"14":0,"15":1},"linkedTransformNodeId":"neutral_bone"}],"needInitialSkinMatrix":false,"ranges":[]}'));a.bones[1].setAbsolutePosition(r.getAbsolutePosition());let s=r.absoluteRotationQuaternion.multiplyInPlace(new BABYLON.Quaternion.RotationYawPitchRoll(Math.PI,Math.PI+.25*Math.PI,0));return a.bones[1].rotationQuaternion=s,a.bones.forEach((function(t,o){let r,a,s,l=[],d=t.getAbsolutePosition(),c=0==d._x&&0==d._y&&0==d._z,h=Y[t.name];if(h&&h.boneColor&&(a=h.boneColor),h&&h.jointColor&&(s=h.jointColor),t.children&&t.children[0]&&!c){let d;r=t.children[0],l=[t.getAbsolutePosition(),r.getAbsolutePosition()],d=n.find((e=>e.name=="skel"+t.name));let c=d&&d.length;d=BABYLON.MeshBuilder.CreateTube("skel"+t.name,{instance:d,updatable:!0,path:l,radius:.012},e),d.material=((e,t,o)=>{const n=new BABYLON.StandardMaterial(e,o);for(let e in n)t[e]&&(n[e]=t[e]);return n})("sphereMaterial",{disableLighting:!0,emissiveColor:BABYLON.Color3.FromHexString(a),diffuseColor:BABYLON.Color3.FromHexString("#000000")},e),c||n.push(d);let u,m=n.find((e=>e.name=="box"+t.name));2==o&&(u=n.find((e=>e.name=="boxx"+t.name)),u?u.position=t.getAbsolutePosition():(u=BABYLON.MeshBuilder.CreateSphere("boxx"+t.name,{segments:4,diameter:parseFloat(i/100)}),u.material=new BABYLON.StandardMaterial("joint"),u.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),u.material.emissiveColor=BABYLON.Color3.FromHexString(s),u.material.disableLighting=!0,u.position=t.getAbsolutePosition(),n.push(u))),m?m.position=r.getAbsolutePosition():(h=Y[r.name],h&&h.jointColor&&(s=h.jointColor),m=BABYLON.MeshBuilder.CreateSphere("box"+t.name,{segments:4,diameter:parseFloat(i/100)}),m.material=new BABYLON.StandardMaterial("joint"),m.material.diffuseColor=BABYLON.Color3.FromHexString("#000000"),m.material.emissiveColor=BABYLON.Color3.FromHexString(s),m.material.disableLighting=!0,m.position=r.getAbsolutePosition(),n.push(m))}})),n}var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(o){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})})),t}var F,P,D=R(Object.freeze({__proto__:null,default:{}})),U=(F=function(e){!function(){var t="input is invalid type",o="object"==typeof window,n=o?window:{};n.JS_MD5_NO_WINDOW&&(o=!1);var i=!o&&"object"==typeof self,r=!n.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;r?n=E:i&&(n=self);var a,s=!n.JS_MD5_NO_COMMON_JS&&e.exports,l=!n.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,d="0123456789abcdef".split(""),c=[128,32768,8388608,-2147483648],h=[0,8,16,24],u=["hex","array","digest","buffer","arrayBuffer","base64"],m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),f=[];if(l){var g=new ArrayBuffer(68);a=new Uint8Array(g),f=new Uint32Array(g)}var p=Array.isArray;!n.JS_MD5_NO_NODE_JS&&p||(p=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var b=ArrayBuffer.isView;!l||!n.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&b||(b=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var B=function(e){var o=typeof e;if("string"===o)return[e,!0];if("object"!==o||null===e)throw new Error(t);if(l&&e.constructor===ArrayBuffer)return[new Uint8Array(e),!1];if(!p(e)&&!b(e))throw new Error(t);return[e,!1]},_=function(e){return function(t){return new w(!0).update(t)[e]()}},x=function(e){var o,i=D,r=D.Buffer;return o=r.from&&!n.JS_MD5_NO_BUFFER_FROM?r.from:function(e){return new r(e)},function(n){if("string"==typeof n)return i.createHash("md5").update(n,"utf8").digest("hex");if(null==n)throw new Error(t);return n.constructor===ArrayBuffer&&(n=new Uint8Array(n)),p(n)||b(n)||n.constructor===r?i.createHash("md5").update(o(n)).digest("hex"):e(n)}},C=function(e){return function(t,o){return new L(t,!0).update(o)[e]()}};function w(e){if(e)f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f,this.buffer8=a;else if(l){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}function L(e,t){var o,n=B(e);if(e=n[0],n[1]){var i,r=[],a=e.length,s=0;for(o=0;o<a;++o)(i=e.charCodeAt(o))<128?r[s++]=i:i<2048?(r[s++]=192|i>>>6,r[s++]=128|63&i):i<55296||i>=57344?(r[s++]=224|i>>>12,r[s++]=128|i>>>6&63,r[s++]=128|63&i):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++o)),r[s++]=240|i>>>18,r[s++]=128|i>>>12&63,r[s++]=128|i>>>6&63,r[s++]=128|63&i);e=r}e.length>64&&(e=new w(!0).update(e).array());var l=[],d=[];for(o=0;o<64;++o){var c=e[o]||0;l[o]=92^c,d[o]=54^c}w.call(this,t),this.update(d),this.oKeyPad=l,this.inner=!0,this.sharedMemory=t}w.prototype.update=function(e){if(this.finalized)throw new Error("finalize already called");var t=B(e);e=t[0];for(var o,n,i=t[1],r=0,a=e.length,s=this.blocks,d=this.buffer8;r<a;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),i)if(l)for(n=this.start;r<a&&n<64;++r)(o=e.charCodeAt(r))<128?d[n++]=o:o<2048?(d[n++]=192|o>>>6,d[n++]=128|63&o):o<55296||o>=57344?(d[n++]=224|o>>>12,d[n++]=128|o>>>6&63,d[n++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++r)),d[n++]=240|o>>>18,d[n++]=128|o>>>12&63,d[n++]=128|o>>>6&63,d[n++]=128|63&o);else for(n=this.start;r<a&&n<64;++r)(o=e.charCodeAt(r))<128?s[n>>>2]|=o<<h[3&n++]:o<2048?(s[n>>>2]|=(192|o>>>6)<<h[3&n++],s[n>>>2]|=(128|63&o)<<h[3&n++]):o<55296||o>=57344?(s[n>>>2]|=(224|o>>>12)<<h[3&n++],s[n>>>2]|=(128|o>>>6&63)<<h[3&n++],s[n>>>2]|=(128|63&o)<<h[3&n++]):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++r)),s[n>>>2]|=(240|o>>>18)<<h[3&n++],s[n>>>2]|=(128|o>>>12&63)<<h[3&n++],s[n>>>2]|=(128|o>>>6&63)<<h[3&n++],s[n>>>2]|=(128|63&o)<<h[3&n++]);else if(l)for(n=this.start;r<a&&n<64;++r)d[n++]=e[r];else for(n=this.start;r<a&&n<64;++r)s[n>>>2]|=e[r]<<h[3&n++];this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},w.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>>2]|=c[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},w.prototype.hash=function(){var e,t,o,n,i,r,a=this.blocks;this.first?t=((t=((e=((e=a[0]-680876937)<<7|e>>>25)-271733879<<0)^(o=((o=(-271733879^(n=((n=(-1732584194^2004318071&e)+a[1]-117830708)<<12|n>>>20)+e<<0)&(-271733879^e))+a[2]-1126478375)<<17|o>>>15)+n<<0)&(n^e))+a[3]-1316259209)<<22|t>>>10)+o<<0:(e=this.h0,t=this.h1,o=this.h2,t=((t+=((e=((e+=((n=this.h3)^t&(o^n))+a[0]-680876936)<<7|e>>>25)+t<<0)^(o=((o+=(t^(n=((n+=(o^e&(t^o))+a[1]-389564586)<<12|n>>>20)+e<<0)&(e^t))+a[2]+606105819)<<17|o>>>15)+n<<0)&(n^e))+a[3]-1044525330)<<22|t>>>10)+o<<0),t=((t+=((e=((e+=(n^t&(o^n))+a[4]-176418897)<<7|e>>>25)+t<<0)^(o=((o+=(t^(n=((n+=(o^e&(t^o))+a[5]+1200080426)<<12|n>>>20)+e<<0)&(e^t))+a[6]-1473231341)<<17|o>>>15)+n<<0)&(n^e))+a[7]-45705983)<<22|t>>>10)+o<<0,t=((t+=((e=((e+=(n^t&(o^n))+a[8]+1770035416)<<7|e>>>25)+t<<0)^(o=((o+=(t^(n=((n+=(o^e&(t^o))+a[9]-1958414417)<<12|n>>>20)+e<<0)&(e^t))+a[10]-42063)<<17|o>>>15)+n<<0)&(n^e))+a[11]-1990404162)<<22|t>>>10)+o<<0,t=((t+=((e=((e+=(n^t&(o^n))+a[12]+1804603682)<<7|e>>>25)+t<<0)^(o=((o+=(t^(n=((n+=(o^e&(t^o))+a[13]-40341101)<<12|n>>>20)+e<<0)&(e^t))+a[14]-1502002290)<<17|o>>>15)+n<<0)&(n^e))+a[15]+1236535329)<<22|t>>>10)+o<<0,t=((t+=((n=((n+=(t^o&((e=((e+=(o^n&(t^o))+a[1]-165796510)<<5|e>>>27)+t<<0)^t))+a[6]-1069501632)<<9|n>>>23)+e<<0)^e&((o=((o+=(e^t&(n^e))+a[11]+643717713)<<14|o>>>18)+n<<0)^n))+a[0]-373897302)<<20|t>>>12)+o<<0,t=((t+=((n=((n+=(t^o&((e=((e+=(o^n&(t^o))+a[5]-701558691)<<5|e>>>27)+t<<0)^t))+a[10]+38016083)<<9|n>>>23)+e<<0)^e&((o=((o+=(e^t&(n^e))+a[15]-660478335)<<14|o>>>18)+n<<0)^n))+a[4]-405537848)<<20|t>>>12)+o<<0,t=((t+=((n=((n+=(t^o&((e=((e+=(o^n&(t^o))+a[9]+568446438)<<5|e>>>27)+t<<0)^t))+a[14]-1019803690)<<9|n>>>23)+e<<0)^e&((o=((o+=(e^t&(n^e))+a[3]-187363961)<<14|o>>>18)+n<<0)^n))+a[8]+1163531501)<<20|t>>>12)+o<<0,t=((t+=((n=((n+=(t^o&((e=((e+=(o^n&(t^o))+a[13]-1444681467)<<5|e>>>27)+t<<0)^t))+a[2]-51403784)<<9|n>>>23)+e<<0)^e&((o=((o+=(e^t&(n^e))+a[7]+1735328473)<<14|o>>>18)+n<<0)^n))+a[12]-1926607734)<<20|t>>>12)+o<<0,t=((t+=((r=(n=((n+=((i=t^o)^(e=((e+=(i^n)+a[5]-378558)<<4|e>>>28)+t<<0))+a[8]-2022574463)<<11|n>>>21)+e<<0)^e)^(o=((o+=(r^t)+a[11]+1839030562)<<16|o>>>16)+n<<0))+a[14]-35309556)<<23|t>>>9)+o<<0,t=((t+=((r=(n=((n+=((i=t^o)^(e=((e+=(i^n)+a[1]-1530992060)<<4|e>>>28)+t<<0))+a[4]+1272893353)<<11|n>>>21)+e<<0)^e)^(o=((o+=(r^t)+a[7]-155497632)<<16|o>>>16)+n<<0))+a[10]-1094730640)<<23|t>>>9)+o<<0,t=((t+=((r=(n=((n+=((i=t^o)^(e=((e+=(i^n)+a[13]+681279174)<<4|e>>>28)+t<<0))+a[0]-358537222)<<11|n>>>21)+e<<0)^e)^(o=((o+=(r^t)+a[3]-722521979)<<16|o>>>16)+n<<0))+a[6]+76029189)<<23|t>>>9)+o<<0,t=((t+=((r=(n=((n+=((i=t^o)^(e=((e+=(i^n)+a[9]-640364487)<<4|e>>>28)+t<<0))+a[12]-421815835)<<11|n>>>21)+e<<0)^e)^(o=((o+=(r^t)+a[15]+530742520)<<16|o>>>16)+n<<0))+a[2]-995338651)<<23|t>>>9)+o<<0,t=((t+=((n=((n+=(t^((e=((e+=(o^(t|~n))+a[0]-198630844)<<6|e>>>26)+t<<0)|~o))+a[7]+1126891415)<<10|n>>>22)+e<<0)^((o=((o+=(e^(n|~t))+a[14]-1416354905)<<15|o>>>17)+n<<0)|~e))+a[5]-57434055)<<21|t>>>11)+o<<0,t=((t+=((n=((n+=(t^((e=((e+=(o^(t|~n))+a[12]+1700485571)<<6|e>>>26)+t<<0)|~o))+a[3]-1894986606)<<10|n>>>22)+e<<0)^((o=((o+=(e^(n|~t))+a[10]-1051523)<<15|o>>>17)+n<<0)|~e))+a[1]-2054922799)<<21|t>>>11)+o<<0,t=((t+=((n=((n+=(t^((e=((e+=(o^(t|~n))+a[8]+1873313359)<<6|e>>>26)+t<<0)|~o))+a[15]-30611744)<<10|n>>>22)+e<<0)^((o=((o+=(e^(n|~t))+a[6]-1560198380)<<15|o>>>17)+n<<0)|~e))+a[13]+1309151649)<<21|t>>>11)+o<<0,t=((t+=((n=((n+=(t^((e=((e+=(o^(t|~n))+a[4]-145523070)<<6|e>>>26)+t<<0)|~o))+a[11]-1120210379)<<10|n>>>22)+e<<0)^((o=((o+=(e^(n|~t))+a[2]+718787259)<<15|o>>>17)+n<<0)|~e))+a[9]-343485551)<<21|t>>>11)+o<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=o-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+o<<0,this.h3=this.h3+n<<0)},w.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,o=this.h2,n=this.h3;return d[e>>>4&15]+d[15&e]+d[e>>>12&15]+d[e>>>8&15]+d[e>>>20&15]+d[e>>>16&15]+d[e>>>28&15]+d[e>>>24&15]+d[t>>>4&15]+d[15&t]+d[t>>>12&15]+d[t>>>8&15]+d[t>>>20&15]+d[t>>>16&15]+d[t>>>28&15]+d[t>>>24&15]+d[o>>>4&15]+d[15&o]+d[o>>>12&15]+d[o>>>8&15]+d[o>>>20&15]+d[o>>>16&15]+d[o>>>28&15]+d[o>>>24&15]+d[n>>>4&15]+d[15&n]+d[n>>>12&15]+d[n>>>8&15]+d[n>>>20&15]+d[n>>>16&15]+d[n>>>28&15]+d[n>>>24&15]},w.prototype.toString=w.prototype.hex,w.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,o=this.h2,n=this.h3;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&o,o>>>8&255,o>>>16&255,o>>>24&255,255&n,n>>>8&255,n>>>16&255,n>>>24&255]},w.prototype.array=w.prototype.digest,w.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},w.prototype.buffer=w.prototype.arrayBuffer,w.prototype.base64=function(){for(var e,t,o,n="",i=this.array(),r=0;r<15;)e=i[r++],t=i[r++],o=i[r++],n+=m[e>>>2]+m[63&(e<<4|t>>>4)]+m[63&(t<<2|o>>>6)]+m[63&o];return e=i[r],n+=m[e>>>2]+m[e<<4&63]+"=="},L.prototype=new w,L.prototype.finalize=function(){if(w.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();w.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(e),w.prototype.finalize.call(this)}};var N=function(){var e=_("hex");r&&(e=x(e)),e.create=function(){return new w},e.update=function(t){return e.create().update(t)};for(var t=0;t<u.length;++t){var o=u[t];e[o]=_(o)}return e}();N.md5=N,N.md5.hmac=function(){var e=C("hex");e.create=function(e){return new L(e)},e.update=function(t,o){return e.create(t).update(o)};for(var t=0;t<u.length;++t){var o=u[t];e[o]=C(o)}return e}(),s?e.exports=N:n.md5=N}()},F(P={exports:{}},P.exports),P.exports),G="1.0.39";function H(t){let o;return{c(){o=function(e){return document.createElement(e)}("canvas"),this.c=e,l(o,"id","renderCanvas"),l(o,"width",t[1]),l(o,"height",t[2]),l(o,"class","canvas")},m(e,n){a(e,o,n),t[35](o)},p(e,t){2&t[0]&&l(o,"width",e[1]),4&t[0]&&l(o,"height",e[2])},i:e,o:e,d(e){e&&s(o),t[35](null)}}}let V=1.3;async function Q(e){const t=await new Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});await t.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults((e=>{})),await t.reset(),await t.send({image:e})}function J(e,t){if(e)for(let o of e)o.visibility=t?1:1e-5}function W(e,t,o){let n,i,r,a,s,l,d,c=S.get_href(),h=u(),m=[],g=[],p=[],b=[],{width:B=1e3}=t,{height:_=1e3}=t,x=!0,C=[],{external_scene_storage:w=null}=t,{show_character:L="human"}=t,{camera_behaviour:N=""}=t,{move_gizmo_thickness:A=1}=t,{scale_gizmo_thickness:y=1}=t,{rotation_gizmo_thickness:v=1}=t,{bone_joint_diameter:$=4}=t,{bone_diameter:O=1.5}=t,{scene:E}=t,{previewbonecolor:R="#003366"}=t,{previewjointscolor:F="#000592"}=t;const P=G;let D;function H(e){l?.resize()}!function(e){u().$$.on_mount.push(e)}((()=>(setTimeout((async()=>{for(;window.in_3d_canvas_init;)await new Promise((e=>setTimeout(e,100)));window.in_3d_canvas_init=!0,await async function(e){l=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0}),l.enableOfflineSupport=!1,l.resize(),BABYLON.Animation.AllowMatricesInterpolation=!0,o(4,E=new BABYLON.Scene(l)),ue=E.clearColor;let t=new BABYLON.ArcRotateCamera("camera1",Math.PI/2,Math.PI/2,3,new BABYLON.Vector3(0,1,0),E);t.attachControl(e,!0),t.lowerRadiusLimit=1.2,t.upperRadiusLimit=8,t.wheelDeltaPercentage=.01,t.onViewMatrixChangedObservable.add((()=>{se({type:"camera",position:t.position,rotation:t.rotation})}));let i=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),E);i.intensity=.6,i.specular=BABYLON.Color3.Black();let r=new BABYLON.DirectionalLight("dir01",new BABYLON.Vector3(0,-.5,-1),E);r.position=new BABYLON.Vector3(0,5,5),n=new BABYLON.ShadowGenerator(1024,r),n.useBlurExponentialShadowMap=!0,n.blurKernel=32;var a=new BABYLON.GridMaterial("groundMaterial",E);a.majorUnitFrequency=1,a.minorUnitVisibility=.1,a.gridRatio=1,a.backFaceCulling=!1,a.mainColor=new BABYLON.Color3(0,0,0),a.lineColor=new BABYLON.Color3(0,0,0),a.opacity=.2,BABYLON.Mesh.CreateGround("ground1",20,20,2,E).material=a,await async function(e,t,n="joint_",i="bone_"){const r=new Promise(((r,a)=>{try{BABYLON.SceneLoader.ImportMesh("",c+"data/",e,E,(function(e,a,l,c){c[0];E.stopAllAnimations();var h=s=l[0],u=e[1];o(33,C=e),d=u,J(C,x),E.meshes.forEach((e=>{e.isPickable=!1})),t.addShadowCaster(E.meshes[0],!0);for(var f=0;f<e.length;f++)e[f].receiveShadows=!1;pe(fe),function(e,t,o="joint_",n="bone_"){p=[],t.bones.forEach((function(t){if(!t.name.includes("neutral")&&!t.name.includes("Skelett")){let i=Y[t.name],r=j[t.name],a="#FF0000";if(!(t.name.includes("Spine1")||t.name.includes("Spine2")||t.name.includes("HeadTop_End")||t.name.includes("Hips")||t.name.includes("Shoulder")||t.name.includes("Finger")||t.name.includes("Middle")||t.name.includes("Index")||t.name.includes("Ring")||t.name.includes("Pinky")||t.name.includes("Toe")||t.name.includes("Thumb"))){const n=BABYLON.MeshBuilder.CreateSphere(o+t.name,{segments:4,diameter:parseFloat($)},E);n.attachToBone(t,e),n.bone=t,n.renderingGroupId=2,i&&i.jointColor&&(a=i.jointColor),r&&r.jointColor&&(a=r.jointColor),n.material=new BABYLON.StandardMaterial("joint");let s=a;F&&(s=F),n.material.diffuseColor=BABYLON.Color3.FromHexString(s),n.renderForAI=!0,n.aiColor=BABYLON.Color3.FromHexString(a),p.push(n)}let s,l=[];t.children&&t.children[0]&&(s=t.children[0],l=[new BABYLON.Vector3(0,0,0),s.position]),a="#ffffff",i&&i.boneColor&&(a=i.boneColor),r&&r.boneColor&&(a=r.boneColor);let d,c=function(e,t){let o=[];for(let n=0;n<t;n++){let i=n/t*Math.PI*2,r=e*Math.cos(i),a=e*Math.sin(i);o.push(new BABYLON.Vector3(r,a,0))}return o}(O,5);if(l.length&&!t.name.includes("Finger")&&!t.name.includes("Thumb")&&!t.name.includes("Hand")){d=new BABYLON.MeshBuilder.ExtrudeShape(n+t.name,{shape:c,closeShape:!0,path:l,sideOrientation:BABYLON.Mesh.DOUBLESIDE,updatable:!0},E),d.renderingGroupId=2,d.bone=t,d.child=s,d.attachToBone(t,e),d.material=new BABYLON.StandardMaterial("bone"),d.renderForAI=!0,d.aiColor=BABYLON.Color3.FromHexString(a);let o=a;R&&(o=R),d.material.diffuseColor=BABYLON.Color3.FromHexString(o),m.push(d)}}})),b=T({scene:E,extrusions:m,spheres:p,specialheadskeleton:b,bone_joint_diameter:$}),g=I(s,g,E),z(g,b)}(u,h,n,i),function(e,t){le=BABYLON.MeshBuilder.CreateBox("box",{height:.06,width:.06,depth:.06}),le.renderingGroupId=2,le.isVisible=!1,ne=t.bones[0];let n=new BABYLON.UtilityLayerRenderer(E);te=new BABYLON.PositionGizmo(n,parseFloat(A)),ee=new BABYLON.RotationGizmo(n,32,!1,parseFloat(v)),oe=new BABYLON.ScaleGizmo(n,parseFloat(y)),te.xGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"position",axis:"x"})})),te.yGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"position",axis:"y"})})),te.zGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"position",axis:"z"})})),ee.xGizmo.dragBehavior.onDragEndObservable.add((()=>{he=!1,le.isVisible=!1,se({type:"rotation",axis:"x"})})),ee.yGizmo.dragBehavior.onDragEndObservable.add((()=>{he=!1,le.isVisible=!1,se({type:"rotation",axis:"y"})})),ee.zGizmo.dragBehavior.onDragEndObservable.add((()=>{he=!1,le.isVisible=!1,se({type:"rotation",axis:"z"})})),ee.xGizmo.dragBehavior.onDragStartObservable.add((()=>{ce="x",le.rotation[ce],he=!0})),ee.yGizmo.dragBehavior.onDragStartObservable.add((()=>{ce="y",le.rotation[ce],he=!0})),ee.zGizmo.dragBehavior.onDragStartObservable.add((()=>{ce="z",le.rotation[ce],he=!0})),oe.xGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"scale",axis:"x"})})),oe.yGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"scale",axis:"y"})})),oe.zGizmo.dragBehavior.onDragEndObservable.add((()=>{se({type:"scale",axis:"z"})}));let i=new BABYLON.AxisScaleGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.FromHexString("#00b894"),n);i.attachedNode=null,ee.updateGizmoRotationToMatchAttachedMesh=!0,ee.updateGizmoPositionToMatchAttachedMesh=!0,te.updateGizmoPositionToMatchAttachedMesh=!0,de="",o(4,E.onPointerDown=function(){const e=E.pick(this.pointerX,this.pointerY);if(e.hit&&"edit_skeleton"===re){if(e.pickedMesh.name.includes("joint_")){let a=e.pickedMesh;if(a.name===de)ee.attachedNode=null,de="";else{de=a.name,ee.jointMesh=a,ie=a.bone.getTransformNode(),le.position=a.bone.getTransformNode().absolutePosition,le.isVisible=!1,ee.attachedNode=ie,i.attachedNode=null;var t=ie.getWorldMatrix(),o=new BABYLON.Quaternion,n=new BABYLON.Vector3,r=new BABYLON.Vector3;t.decompose(r,o,n);let e=o.toEulerAngles();le.rotation=e}}e.pickedMesh.name.includes("bone_")}},E)}((e[1],e[2]),h),r(!0)}))}catch(e){a(e)}}));await r}("Y_Bot.glb",n,"joint_","bone_"),me=E.enableDepthRenderer(),l.hideLoadingUI(),function(e){e.runRenderLoop((function(){E&&E.activeCamera&&(he&&"edit_skeleton"===re&&le.rotation[ce],E.render())}))}(l),window.in_3d_canvas_init=!1}(be)}),0),()=>{w&&o(5,w.data=X(),w)})));let W={joints:{},root:{}};function Z(e="joint_"){return function(e="joint_"){const t=BABYLON.Vector3.Zero(),o=BABYLON.Vector3.Zero(),n=BABYLON.Quaternion.Zero();ne.getLocalMatrix().decompose(o,n,t),W.root={scaling:o.clone(),rotationQ:n.clone(),position:t.clone()};for(let i of E.meshes)i.name.includes(e)&&(i.bone.getLocalMatrix().decompose(o,n,t),W.joints[i.name]={scaling:o.clone(),rotationQ:n.clone(),position:t.clone()})}(e),[JSON.parse(JSON.stringify(W))]}function K(e){W=e[0],function(e){let t=ne.getTransformNode(),o=W.root;t.rotationQuaternion=new BABYLON.Quaternion(o.rotationQ._x,o.rotationQ._y,o.rotationQ._z,o.rotationQ._w),t.position=new BABYLON.Vector3(o.position._x,o.position._y,o.position._z),t.scaling=new BABYLON.Vector3(o.scaling._x,o.scaling._y,o.scaling._z);for(let n of E.meshes)if(n.name.includes(e)){let e=n.bone;t=e.getTransformNode(),o=W.joints[n.name],t.rotationQuaternion=new BABYLON.Quaternion(o.rotationQ._x,o.rotationQ._y,o.rotationQ._z,o.rotationQ._w),t.position=new BABYLON.Vector3(o.position._x,o.position._y,o.position._z),t.scaling=new BABYLON.Vector3(o.scaling._x,o.scaling._y,o.scaling._z),t.rotationQuaternion?e.rotationQuaternion=t.rotationQuaternion:e.rotation=t.rotation,e.scaling=t.scaling}}("joint_")}function X(){let e={},t=E.activeCamera;return e.position=JSON.parse(JSON.stringify(t.position)),e.rotation=JSON.parse(JSON.stringify(t.rotation)),{cameraInfo:e,poseInfo:Z()}}async function q(){let e=re;ae(""),await k();let t=be.toDataURL();return ae(e),t}let ee,te,oe,ne,ie,{mode:re=""}=t;function ae(e){"edit_skeleton"===e&&ee&&te&&(ee&&(ee.attachedNode=null),te&&(te.attachedNode=null),oe&&(oe.attachedNode=null)),"move_rotate"===e&&ne&&(ee.attachedNode=ne.getTransformNode(),te.attachedNode=ne.getTransformNode(),oe&&(oe.attachedNode=null)),"scale"===e&&ee&&te&&(ee.attachedNode=null,te.attachedNode=null,oe&&(oe.attachedNode=ne.getTransformNode())),""===e&&ee&&te&&(ee.attachedNode=null,te.attachedNode=null,oe.attachedNode=null)}function se(e){h.dispatchEvent(new CustomEvent("change",{detail:e})),g=I(s,g),b=T({scene:E,extrusions:m,spheres:p,specialheadskeleton:b,bone_joint_diameter:$})}let le,de,ce,he=!1;let ue,me,{background_type:fe="transparent"}=t,ge=null;function pe(e="grey"){E&&("transparent"===e&&(ge&&(ge.dispose(),ge=null),o(4,E.clearColor=new BABYLON.Color4(0,0,0,0),E)),"grey"===e&&(ge||(ge=E.createDefaultEnvironment({enableGroundShadow:!0}),ge.setMainColor(BABYLON.Color3.Gray()),ge.ground.position.y+=.01),o(4,E.clearColor=ue,E)),"black"===e&&(ge&&(ge.dispose(),ge=null),o(4,E.clearColor=new BABYLON.Color4(0,0,0,255),E)))}let{canvas:be}=t;return e.$$set=e=>{"width"in e&&o(1,B=e.width),"height"in e&&o(2,_=e.height),"external_scene_storage"in e&&o(5,w=e.external_scene_storage),"show_character"in e&&o(3,L=e.show_character),"camera_behaviour"in e&&o(6,N=e.camera_behaviour),"move_gizmo_thickness"in e&&o(7,A=e.move_gizmo_thickness),"scale_gizmo_thickness"in e&&o(8,y=e.scale_gizmo_thickness),"rotation_gizmo_thickness"in e&&o(9,v=e.rotation_gizmo_thickness),"bone_joint_diameter"in e&&o(10,$=e.bone_joint_diameter),"bone_diameter"in e&&o(11,O=e.bone_diameter),"scene"in e&&o(4,E=e.scene),"previewbonecolor"in e&&o(12,R=e.previewbonecolor),"previewjointscolor"in e&&o(13,F=e.previewjointscolor),"mode"in e&&o(26,re=e.mode),"background_type"in e&&o(30,fe=e.background_type),"canvas"in e&&o(0,be=e.canvas)},e.$$.update=()=>{e.$$.dirty[0],8&e.$$.dirty[0]|6&e.$$.dirty[1]&&(o(32,x="human"==L),J(C,x)),1073741824&e.$$.dirty[0]&&fe&&pe(fe),67108864&e.$$.dirty[0]&&re&&ae(re),81&e.$$.dirty[0]&&E&&(N||E.activeCamera.attachControl(be,!0),"lock"===N&&E.activeCamera.detachControl()),8&e.$$.dirty[1]&&!D&&h&&(o(34,D=!0),new ResizeObserver(H).observe(h))},[be,B,_,L,E,w,N,A,y,v,$,O,R,F,async function(e){return"version"===e?new Promise((e=>{e(G)})):await S.getInfo(e,"@fds-components/fds-pose-editor")},P,async function(){a&&(a.isVisible=!1),await function(e,t){e.forEach((function(e){e.visibility=1})),t.forEach((function(e){e.visibility=1}))}(g,b),await M("hide",s,m,p),se({type:"position",axis:"z"}),ae("");let e=fe;pe("black");let t=L;o(3,L="");for(let e of E.meshes)e.renderForAI&&(e.material.disableLighting=!0,e.material.emissiveColor=e.aiColor);await k(),o(3,L=t);let n=be.toDataURL();for(let e of E.meshes)e.renderForAI&&(e.material.disableLighting=!1,e.material.emissiveColor=BABYLON.Color3.FromHexString("#000000"));return pe(e),z(g,b),M("show",s,m,p),a&&(a.isVisible=!0),n},async function(){let e=E.meshes;if(!e.length)return;ae("");let t=e[0].getBoundingInfo().boundingBox.minimumWorld,n=e[0].getBoundingInfo().boundingBox.maximumWorld;for(let o of e)if("ground1"!==o.name&&"__root__"!==o.name&&!o.name.includes("Background")){const e=o.getBoundingInfo().boundingBox.minimumWorld,i=o.getBoundingInfo().boundingBox.maximumWorld;t=BABYLON.Vector3.Minimize(t,e),n=BABYLON.Vector3.Maximize(n,i)}let i=Math.max(n.x,n.y),r=E.activeCamera.minZ,a=E.activeCamera.maxZ;o(4,E.activeCamera.minZ=1.2,E),o(4,E.activeCamera.maxZ=i,E),await k();let s=me.getDepthMap(),l=be.width,d=be.height,c=new Promise((e=>{s.readPixels().then((t=>{for(let e=0;e<t.length;e+=4)t[e+1]=t[e+2]=t[e];BABYLON.Tools.DumpData(s.getSize().width,s.getSize().height,t,(t=>{let o=window.document.createElement("canvas");o.width=l,o.height=d;const n=new Image;n.src=t,n.onload=()=>{let t=o.getContext("2d");t.scale(1,-1),t.filter="invert(1)",t.drawImage(n,0,-d,l,d);let i=o.toDataURL();e(i)}}))}))})),h=await c;return o(4,E.activeCamera.minZ=r,E),o(4,E.activeCamera.maxZ=a,E),h},Z,K,function(e){return U.md5(e)},async function(){let e=await q(),t={},o=E.activeCamera;return t.position=JSON.parse(JSON.stringify(o.position)),t.rotation=JSON.parse(JSON.stringify(o.rotation)),{cameraInfo:t,poseInfo:Z(),image:e}},X,function(e){if(ne){K(e.poseInfo);let t=E.activeCamera;t.position=e.cameraInfo.position,t.rotation=e.cameraInfo.rotation}else setTimeout((()=>{K(e.poseInfo);let t=E.activeCamera;t.position=e.cameraInfo.position,t.rotation=e.cameraInfo.rotation}),1200)},async function(e){await async function(e){new Promise(((t,o)=>{try{BABYLON.SceneLoader.ImportAnimations(e,"",E,!1,BABYLON.SceneLoaderAnimationGroupLoadingMode.Clean,null,(e=>{e.animationGroups.length>0&&(i=e.animationGroups[0],t(!0))}))}catch(e){o(e)}}))}(e),E.executeWhenReady((()=>{r=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),a=new BABYLON.GUI.StackPanel,a.width="350px",a.fontSize="14px",a.name="animControls",a.paddingBottom="50px",a.paddingLeft="20px",a.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,E.animationGroups.forEach((e=>{e.pause(),E.stopAllAnimations();var t=new BABYLON.GUI.Slider;t.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,t.minimum=e.from,t.maximum=e.to,t.name="slider",t.color="white",t.barOffset="9px",t.thumbWidth="35px",t.isThumbCircle=!0,t.value=0,t.height="30px",t.width="300px",t.paddingTop="10px",e.from!=e.to&&(r.addControl(a),a.addControl(t)),ne.getTransformNode().rotate(BABYLON.Axis.X,Math.PI/2,BABYLON.Space.WORLD),ne.getTransformNode().setAbsolutePosition(new BABYLON.Vector3(0,1.1,0)),ne.getTransformNode().scaling.x=V,ne.getTransformNode().scaling.y=V,ne.getTransformNode().scaling.z=V,t.onValueChangedObservable.add((t=>{e.goToFrame(t),e.play(),e.pause(),ne.getTransformNode().rotate(BABYLON.Axis.X,Math.PI/2,BABYLON.Space.WORLD),ne.getTransformNode().setAbsolutePosition(new BABYLON.Vector3(0,1.1,0)),ne.getTransformNode().scaling.x=V,ne.getTransformNode().scaling.y=V,ne.getTransformNode().scaling.z=V}))}))}))},q,re,ae,Q,function(e,t){let o=new BABYLON.Debug.SkeletonViewer(t,e,E);o.isEnabled=!0,o.color=BABYLON.Color3.Red()},fe,pe,x,C,D,function(e){f[e?"unshift":"push"]((()=>{be=e,o(0,be)}))}]}class Z extends ${constructor(e){super();const t=document.createElement("style");t.textContent=".canvas{width:100%;height:100%}*{box-sizing:border-box}",this.shadowRoot.appendChild(t),v(this,{target:this.shadowRoot,props:d(this.attributes),customElement:!0},W,H,r,{width:1,height:2,external_scene_storage:5,show_character:3,camera_behaviour:6,move_gizmo_thickness:7,scale_gizmo_thickness:8,rotation_gizmo_thickness:9,bone_joint_diameter:10,bone_diameter:11,scene:4,previewbonecolor:12,previewjointscolor:13,getInfo:14,version:15,renderForAI:16,renderForAIDepth:17,getPose:18,setPose:19,md5:20,getScene:21,getSceneNoImage:22,setScene:23,loadAnimation:24,renderNormal:25,mode:26,setMode:27,getPoseFromImage:28,addSkeletonViewer:29,background_type:30,setBackground:31,canvas:0},null,[-1,-1,-1]),e&&(e.target&&a(e.target,this,e.anchor),e.props&&(this.$set(e.props),w()))}static get observedAttributes(){return["width","height","external_scene_storage","show_character","camera_behaviour","move_gizmo_thickness","scale_gizmo_thickness","rotation_gizmo_thickness","bone_joint_diameter","bone_diameter","scene","previewbonecolor","previewjointscolor","getInfo","version","renderForAI","renderForAIDepth","getPose","setPose","md5","getScene","getSceneNoImage","setScene","loadAnimation","renderNormal","mode","setMode","getPoseFromImage","addSkeletonViewer","background_type","setBackground","canvas"]}get width(){return this.$$.ctx[1]}set width(e){this.$$set({width:e}),w()}get height(){return this.$$.ctx[2]}set height(e){this.$$set({height:e}),w()}get external_scene_storage(){return this.$$.ctx[5]}set external_scene_storage(e){this.$$set({external_scene_storage:e}),w()}get show_character(){return this.$$.ctx[3]}set show_character(e){this.$$set({show_character:e}),w()}get camera_behaviour(){return this.$$.ctx[6]}set camera_behaviour(e){this.$$set({camera_behaviour:e}),w()}get move_gizmo_thickness(){return this.$$.ctx[7]}set move_gizmo_thickness(e){this.$$set({move_gizmo_thickness:e}),w()}get scale_gizmo_thickness(){return this.$$.ctx[8]}set scale_gizmo_thickness(e){this.$$set({scale_gizmo_thickness:e}),w()}get rotation_gizmo_thickness(){return this.$$.ctx[9]}set rotation_gizmo_thickness(e){this.$$set({rotation_gizmo_thickness:e}),w()}get bone_joint_diameter(){return this.$$.ctx[10]}set bone_joint_diameter(e){this.$$set({bone_joint_diameter:e}),w()}get bone_diameter(){return this.$$.ctx[11]}set bone_diameter(e){this.$$set({bone_diameter:e}),w()}get scene(){return this.$$.ctx[4]}set scene(e){this.$$set({scene:e}),w()}get previewbonecolor(){return this.$$.ctx[12]}set previewbonecolor(e){this.$$set({previewbonecolor:e}),w()}get previewjointscolor(){return this.$$.ctx[13]}set previewjointscolor(e){this.$$set({previewjointscolor:e}),w()}get getInfo(){return this.$$.ctx[14]}get version(){return this.$$.ctx[15]}get renderForAI(){return this.$$.ctx[16]}get renderForAIDepth(){return this.$$.ctx[17]}get getPose(){return this.$$.ctx[18]}get setPose(){return this.$$.ctx[19]}get md5(){return this.$$.ctx[20]}get getScene(){return this.$$.ctx[21]}get getSceneNoImage(){return this.$$.ctx[22]}get setScene(){return this.$$.ctx[23]}get loadAnimation(){return this.$$.ctx[24]}get renderNormal(){return this.$$.ctx[25]}get mode(){return this.$$.ctx[26]}set mode(e){this.$$set({mode:e}),w()}get setMode(){return this.$$.ctx[27]}get getPoseFromImage(){return Q}get addSkeletonViewer(){return this.$$.ctx[29]}get background_type(){return this.$$.ctx[30]}set background_type(e){this.$$set({background_type:e}),w()}get setBackground(){return this.$$.ctx[31]}get canvas(){return this.$$.ctx[0]}set canvas(e){this.$$set({canvas:e}),w()}}return customElements.define("fds-pose-editor",Z),Z}();
//# sourceMappingURL=fds-pose-editor.js.map
